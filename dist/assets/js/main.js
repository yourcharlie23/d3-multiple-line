function drawGraph(){xScale.domain(d3.extent(data,function(t){return t[xLabel]})),yScale.domain([d3.min(concentrations,function(t){return d3.min(t.datapoints,function(t){return t.concentration})}),d3.max(concentrations,function(t){return d3.max(t.datapoints,function(t){return t.concentration})})]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll("text").attr("y",10),svg.append("g").attr("class","y axis").transition().duration(500).call(yAxis).on("end",function(){d3.select(this).append("text").attr("class","label").attr("y",-10).attr("fill","#333333").style("text-anchor","end").text("Production")}),svg.selectAll(".y.axis text").attr("dy",-4),tooltipLine=svg.append("line"),tipBox=svg.append("rect").attr("width",width).attr("height",height).attr("opacity",0).on("mousemove",drawTooltip).on("mouseout",removeTooltip);(categoryLine=svg.selectAll(".category").data(concentrations).enter().append("g").attr("class","category")).append("path").attr("class","line").attr("d",function(t){return line(t.datapoints)}).attr("stroke-width","2px").attr("fill","none").attr("stroke",function(t){return color(t.category)}).on("mouseover",function(t){d3.select(this).style("stroke-width","3px")}).on("mousemove",drawTooltip).on("mouseout",function(){d3.select(this).style("stroke-width","2px")}).each(function(t){t.totalLength=this.getTotalLength()}).attr("stroke-dasharray",function(t){return t.totalLength+" "+t.totalLength}).attr("stroke-dashoffset",function(t){return t.totalLength}).transition().duration(500).attr("stroke-dashoffset",0),categoryLine.append("g").selectAll("circle").data(function(t){return t.datapoints}).enter().append("circle").attr("class",function(t){return"circle-"+t.date}).attr("r",2).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(t.concentration)}).attr("fill",function(t){return color(t.category)}).style("stroke",function(t){return color(t.category)}).style("display","none")}function resize(){var t=.83*parseInt(d3.select(".chart-info").style("width"));d3.selectAll("#chart").transition().style("width",t).duration(100).delay(200).on("end",adjust)}function adjust(){width=parseInt(d3.select("#chart").style("width"))-margin.left-margin.right,height=parseInt(d3.select("#chart").style("height"))-margin.top-margin.bottom,xScale.range([0,width]),yScale.range([height,0]),yAxis.tickSize(-width,0,0),svg.select(".x.axis").attr("transform","translate(0,"+height+")").call(xAxis),svg.select(".y.axis").call(yAxis),svg.selectAll(".line").attr("d",function(t){return line(t.datapoints)}),svg.selectAll("circle").attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(t.concentration)}),svg.selectAll("rect").attr("width",width).attr("height",height),xAxis.ticks(Math.floor(Math.max(width/65,4))),yAxis.ticks(Math.floor(Math.max(height/30,4)))}var categories,xLabel,data,categoryLine,tipBox,concentrations,tooltipLine,margin={top:20,right:20,bottom:30,left:50},width=parseInt(d3.select("#chart").style("width"))-margin.left-margin.right,height=parseInt(d3.select("#chart").style("height"))-margin.top-margin.bottom,yMax=28e3,xScale=d3.scaleLinear().range([0,width]),yScale=d3.scaleLinear().range([height,0]),color=d3.scaleOrdinal().range(["#FABE9C","#F6AB9A","#FED47D"]),xAxis=d3.axisBottom(xScale).tickFormat(d3.format("d")),yAxis=d3.axisLeft(yScale).tickSize(width).tickSize(-width,0,0),line=d3.line().curve(d3.curveBasis).x(function(t){return xScale(t.date)}).y(function(t){return yScale(t.concentration)}),totalHeight=height+margin.top+margin.bottom,svg=d3.select("#chart").style("width",width+margin.left+margin.right).style("height",totalHeight).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),tooltip=d3.select("#tooltip"),removeTooltip=function(){tooltip&&tooltip.style("display","none"),tooltipLine&&tooltipLine.attr("stroke","none"),d3.selectAll("circle").style("display","none")},drawTooltip=function(){var t=xScale.invert(d3.mouse(tipBox.node())[0]),e=Math.floor(t),a={};concentrations.forEach(function(t){var n=_.find(t.datapoints,{date:""+e});n&&(a[t.category]=n)}),d3.selectAll("circle").style("display","none"),d3.selectAll(".circle-"+e).style("display","block");var n=parseInt(d3.select(".chart-info").style("height"))-height-margin.top-margin.bottom+d3.mouse(this)[1];tooltipLine.attr("stroke","#bdbdbd").attr("x1",xScale(e)).attr("x2",xScale(e)).attr("y1",0).attr("y2",height),tooltip.html("<div>"+e+"</div>").style("display","block").style("font-weight","bold").style("left",d3.mouse(tipBox.node())[0]+margin.left+margin.right+"px").style("top",n+"px"),tooltip.append("ul").attr("class","legends-list"),_.each(a,function(t,e){if(!t.isDisabled){var a="<div class='title inline-b'>"+e+"</div> <div class='desc inline-b'>"+t.concentration+"</div>";tooltip.select("ul").append("li").attr("class","col-4").style("color",function(t){return color(e)}).html(a)}})},sortCategoryLegend=function(){categories.map(function(t,e){legends.append("li").attr("class","col-4 "+(t.isDisabled?"exclude":"")).style("color",function(e){return color(t.name)}).html("<span class='default-color'>"+t.name+"</span>").on("click",function(e){t.isDisabled=!t.isDisabled,categories=_.sortBy(categories,[function(t){return t.isDisabled}]),legends.html(""),sortCategoryLegend(),concentrations=categories.map(function(t,e){if(!t.isDisabled)return{category:t.name,datapoints:data.map(function(e){return{date:e[xLabel],concentration:+e[t.name]}})}}),concentrations=_.compact(concentrations),svg.html(""),drawGraph()})})},legends=d3.select("#legends ul");d3.csv("./assets/data/milledRiceEndingStocks.csv",function(t,e){if(t)throw t;data=e,xLabel=d3.keys(data[0])[0],categories=d3.keys(data[0]).slice(1),color.domain(categories),concentrations=categories.map(function(t,e){return categories[e]={name:t,isDisabled:!1},legends.html(""),sortCategoryLegend(),{category:t,datapoints:data.map(function(e){return{date:e[xLabel],concentration:+e[t]}})}}),drawGraph()}),d3.select(window).on("resize",resize),adjust();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9qcy9tYWluLmpzIl0sIm5hbWVzIjpbImRyYXdHcmFwaCIsInhTY2FsZSIsImRvbWFpbiIsImQzIiwiZXh0ZW50IiwiZGF0YSIsImQiLCJ4TGFiZWwiLCJ5U2NhbGUiLCJtaW4iLCJjb25jZW50cmF0aW9ucyIsImMiLCJkYXRhcG9pbnRzIiwidiIsImNvbmNlbnRyYXRpb24iLCJtYXgiLCJzdmciLCJhcHBlbmQiLCJhdHRyIiwiY2FsbCIsInhBeGlzIiwic2VsZWN0QWxsIiwidHJhbnNpdGlvbiIsImR1cmF0aW9uIiwieUF4aXMiLCJvbiIsInNlbGVjdCIsInRoaXMiLCJzdHlsZSIsInRleHQiLCJ0b29sdGlwTGluZSIsInRpcEJveCIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhd1Rvb2x0aXAiLCJyZW1vdmVUb29sdGlwIiwiY2F0ZWdvcnlMaW5lIiwiZW50ZXIiLCJsaW5lIiwiY29sb3IiLCJjYXRlZ29yeSIsImVhY2giLCJ0b3RhbExlbmd0aCIsImdldFRvdGFsTGVuZ3RoIiwiZGQiLCJkYXRlIiwicmVzaXplIiwiY2hhcnRDb250YWluZXJXaWR0aCIsInBhcnNlSW50IiwiZGVsYXkiLCJhZGp1c3QiLCJtYXJnaW4iLCJsZWZ0IiwicmlnaHQiLCJ0b3AiLCJib3R0b20iLCJyYW5nZSIsInRpY2tTaXplIiwidGlja3MiLCJNYXRoIiwiZmxvb3IiLCJjYXRlZ29yaWVzIiwieU1heCIsInNjYWxlTGluZWFyIiwic2NhbGVPcmRpbmFsIiwiYXhpc0JvdHRvbSIsInRpY2tGb3JtYXQiLCJmb3JtYXQiLCJheGlzTGVmdCIsImN1cnZlIiwiY3VydmVCYXNpcyIsIngiLCJ5IiwidG90YWxIZWlnaHQiLCJ0b29sdGlwIiwieDAiLCJpbnZlcnQiLCJtb3VzZSIsIm5vZGUiLCJ4RGF0YSIsImhvdmVyQWxsRGF0YSIsImZvckVhY2giLCJpdGVtIiwiY2F0RGF0YSIsIl8iLCJmaW5kIiwieUNvb3IiLCJodG1sIiwiaW5kZXgiLCJpc0Rpc2FibGVkIiwibGlIdG1sIiwic29ydENhdGVnb3J5TGVnZW5kIiwibWFwIiwibGVnZW5kcyIsIm5hbWUiLCJzb3J0QnkiLCJvIiwiY29tcGFjdCIsImNzdiIsImVycm9yIiwiY3N2ZGF0YSIsImtleXMiLCJzbGljZSIsIndpbmRvdyJdLCJtYXBwaW5ncyI6IkFBZ0tBLFNBQVNBLFlBRVBDLE9BQU9DLE9BQU9DLEdBQUdDLE9BQU9DLEtBQU0sU0FBU0MsR0FBSyxPQUFPQSxFQUFFQyxXQUNyREMsT0FBT04sUUFDTEMsR0FBR00sSUFBSUMsZUFBZ0IsU0FBU0MsR0FBSyxPQUFPUixHQUFHTSxJQUFJRSxFQUFFQyxXQUFZLFNBQVNDLEdBQUssT0FBT0EsRUFBRUMsa0JBQ3hGWCxHQUFHWSxJQUFJTCxlQUFnQixTQUFTQyxHQUFLLE9BQU9SLEdBQUdZLElBQUlKLEVBQUVDLFdBQVksU0FBU0MsR0FBSyxPQUFPQSxFQUFFQyxvQkFJMUZFLElBQUlDLE9BQU8sS0FDTkMsS0FBSyxRQUFTLFVBQ2RBLEtBQUssWUFBYSxlQUFpQixPQUFXLEtBQzlDQyxLQUFLQyxPQUNMQyxVQUFVLFFBQ1ZILEtBQUssSUFBSyxJQUlmRixJQUFJQyxPQUFPLEtBQ05DLEtBQUssUUFBUyxVQUNkSSxhQUFhQyxTQUFTLEtBQ3RCSixLQUFLSyxPQUNMQyxHQUFHLE1BQU8sV0FDVHRCLEdBQUd1QixPQUFPQyxNQUFNVixPQUFPLFFBQ3RCQyxLQUFLLFFBQVMsU0FDZEEsS0FBSyxLQUFNLElBR1hBLEtBQUssT0FBUSxXQUNiVSxNQUFNLGNBQWUsT0FDckJDLEtBQUssZ0JBSVpiLElBQUlLLFVBQVUsZ0JBQWdCSCxLQUFLLE1BQU8sR0FHMUNZLFlBQWNkLElBQUlDLE9BQU8sUUFHekJjLE9BQVNmLElBQUlDLE9BQU8sUUFDZkMsS0FBSyxRQUFTYyxPQUNkZCxLQUFLLFNBQVVlLFFBQ2ZmLEtBQUssVUFBVyxHQUNoQk8sR0FBRyxZQUFhUyxhQUNoQlQsR0FBRyxXQUFZVSxnQkFJcEJDLGFBQWVwQixJQUFJSyxVQUFVLGFBQ3hCaEIsS0FBS0ssZ0JBQ0wyQixRQUFR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RixHQUN4RCxPQUFRdUMsS0FBTXZDLEVBQUVDLFFBQVNPLGVBQWdCUixFQUFFa0MsU0FJL0N4QyxjQXlKRkcsR0FBR3VCLE9BQU82RSxRQUFROUUsR0FBRyxTQUFXcUIsUUFHaENJIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBEZWZpbmUgbWFyZ2luc1xudmFyIG1hcmdpbiA9IHt0b3A6IDIwLCByaWdodDogMjAsIGJvdHRvbTogMzAsIGxlZnQ6IDUwfSxcbndpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KCcjY2hhcnQnKS5zdHlsZSgnd2lkdGgnKSkgLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodCxcbmhlaWdodCA9IHBhcnNlSW50KGQzLnNlbGVjdCgnI2NoYXJ0Jykuc3R5bGUoJ2hlaWdodCcpKSAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tO1xuXG52YXIgeU1heCA9IDI4MDAwO1xuXG4vLyBEZWZpbmUgc2NhbGVzXG52YXIgeFNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKS5yYW5nZShbMCwgd2lkdGhdKTtcbnZhciB5U2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpLnJhbmdlKFtoZWlnaHQsIDBdKTtcbnZhciBjb2xvciA9IGQzLnNjYWxlT3JkaW5hbCgpXG4gICAgICAucmFuZ2UoWycjRkFCRTlDJywgJyNGNkFCOUEnLCAnI0ZFRDQ3RCddKTtcblxudmFyIGNhdGVnb3JpZXMsIHhMYWJlbCwgZGF0YTtcblxuLy8gRGVmaW5lIGF4ZXNcbnZhciB4QXhpcyA9IGQzLmF4aXNCb3R0b20oeFNjYWxlKS50aWNrRm9ybWF0KGQzLmZvcm1hdCgnZCcpKTtcbnZhciB5QXhpcyA9IGQzLmF4aXNMZWZ0KHlTY2FsZSkudGlja1NpemUod2lkdGgpLnRpY2tTaXplKC13aWR0aCwgMCwgMCk7XG5cbi8vIERlZmluZSBsaW5lc1xudmFyIGxpbmUgPSBkMy5saW5lKCkuY3VydmUoZDMuY3VydmVCYXNpcylcbiAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHhTY2FsZShkWydkYXRlJ10pOyB9KVxuICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4geVNjYWxlKGRbJ2NvbmNlbnRyYXRpb24nXSk7IH0pO1xuXG4vLyBEZWZpbmUgc3ZnIGNhbnZhc1xudmFyIHRvdGFsSGVpZ2h0ID0gaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b207XG52YXIgY2F0ZWdvcnlMaW5lLCB0aXBCb3gsIGNvbmNlbnRyYXRpb25zO1xudmFyIHN2ZyA9IGQzLnNlbGVjdCgnI2NoYXJ0JylcbiAgICAgICAgICAgIC5zdHlsZSgnd2lkdGgnLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgICAgICAgICAgLnN0eWxlKCdoZWlnaHQnLCB0b3RhbEhlaWdodClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIG1hcmdpbi5sZWZ0ICsgJywnICsgbWFyZ2luLnRvcCArICcpJyk7XG5cbnZhciB0b29sdGlwID0gZDMuc2VsZWN0KCcjdG9vbHRpcCcpO1xudmFyIHRvb2x0aXBMaW5lO1xuXG52YXIgcmVtb3ZlVG9vbHRpcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodG9vbHRpcCkgdG9vbHRpcC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgaWYgKHRvb2x0aXBMaW5lKSB0b29sdGlwTGluZS5hdHRyKCdzdHJva2UnLCAnbm9uZScpO1xuICAgIGQzLnNlbGVjdEFsbCgnY2lyY2xlJykuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xufVxuXG52YXIgZHJhd1Rvb2x0aXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHgwID0geFNjYWxlLmludmVydChkMy5tb3VzZSh0aXBCb3gubm9kZSgpKVswXSksXG4gICAgeERhdGEgPSBNYXRoLmZsb29yKHgwKSxcbiAgICBob3ZlckFsbERhdGEgPSB7fTtcblxuICAgIC8vIEdldCBhbGwgcmVsYXRlZCBkYXRhXG4gICAgY29uY2VudHJhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIGNhdERhdGEgPSBfLmZpbmQoaXRlbS5kYXRhcG9pbnRzLCB7ICdkYXRlJzogJycreERhdGEgfSlcbiAgICAgIGlmIChjYXREYXRhKSB7XG4gICAgICAgIGhvdmVyQWxsRGF0YVtpdGVtLmNhdGVnb3J5XSA9IGNhdERhdGE7XG4gICAgICB9XG4gICAgfSlcblxuICAgIC8vIEhpZGUvc2hvdyBjaXJjbGVcbiAgICBkMy5zZWxlY3RBbGwoJ2NpcmNsZScpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICBkMy5zZWxlY3RBbGwoJy5jaXJjbGUtJyt4RGF0YSkuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICBcbiAgICAvLyBQbGFjaW5nIG9mIHRvb2x0aXAgIFxuICAgIHZhciB5Q29vciA9IChwYXJzZUludChkMy5zZWxlY3QoJy5jaGFydC1pbmZvJykuc3R5bGUoJ2hlaWdodCcpKSAtIGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tKSArIGQzLm1vdXNlKHRoaXMpWzFdXG4gICAgXG4gICAgLy8gUmVwb3NpdGlvbiBsaW5lXG4gICAgdG9vbHRpcExpbmUuYXR0cignc3Ryb2tlJywgJyNiZGJkYmQnKVxuICAgICAgLmF0dHIoJ3gxJywgeFNjYWxlKHhEYXRhKSlcbiAgICAgIC5hdHRyKCd4MicsIHhTY2FsZSh4RGF0YSkpXG4gICAgICAuYXR0cigneTEnLCAwKVxuICAgICAgLmF0dHIoJ3kyJywgaGVpZ2h0KTtcbiAgICBcbiAgICAvLyBEaXNwbGF5IGluZm9cbiAgICB0b29sdGlwLmh0bWwoXCI8ZGl2PlwiK3hEYXRhK1wiPC9kaXY+XCIpXG4gICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKVxuICAgICAgLnN0eWxlKCdmb250LXdlaWdodCcsICdib2xkJylcbiAgICAgIC5zdHlsZSgnbGVmdCcsIChkMy5tb3VzZSh0aXBCb3gubm9kZSgpKVswXSArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KSArICdweCcpXG4gICAgICAuc3R5bGUoJ3RvcCcsIHlDb29yICsgJ3B4Jyk7XG5cbiAgICAvLyBBZGQgY2xhc3Mgc2FtZSBhcyB0aGUgbGVnZW5kc1xuICAgIHRvb2x0aXAuYXBwZW5kKCd1bCcpXG4gICAgICAuYXR0cignY2xhc3MnLCAnbGVnZW5kcy1saXN0Jyk7XG5cbiAgICAvLyBEaXNwbGF5IGhvdmVyIGRhdGFcbiAgICBfLmVhY2goaG92ZXJBbGxEYXRhLCBmdW5jdGlvbihjYXRlZ29yeSwgaW5kZXgpIHtcbiAgICAgIGlmICghY2F0ZWdvcnkuaXNEaXNhYmxlZCkge1xuICAgICAgICB2YXIgbGlIdG1sID0gXCI8ZGl2IGNsYXNzPSd0aXRsZSBpbmxpbmUtYic+XCIrXG4gICAgICAgICAgICBpbmRleCtcIjwvZGl2PiA8ZGl2IGNsYXNzPSdkZXNjIGlubGluZS1iJz5cIitjYXRlZ29yeS5jb25jZW50cmF0aW9uK1wiPC9kaXY+XCJcbiAgICAgICAgdmFyIGxpID0gdG9vbHRpcC5zZWxlY3QoJ3VsJykuYXBwZW5kKCdsaScpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NvbC00JylcbiAgICAgICAgICAuc3R5bGUoJ2NvbG9yJywgZnVuY3Rpb24oZCkge3JldHVybiBjb2xvcihpbmRleCk7IH0pO1xuICAgICAgICBcbiAgICAgICAgbGkuaHRtbChsaUh0bWwpOyBcbiAgICAgIH1cbiAgICB9KVxuXG59XG5cbi8vIFNvcnQgY2F0ZWdvcnkgbGVnZW5kIGFuZCByZWNhbGN1bGF0ZSBkYXRhIGFnYWluIGZvciB0aGUgc2hvd24gbGVnZW5kc1xudmFyIHNvcnRDYXRlZ29yeUxlZ2VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgY2F0ZWdvcmllcy5tYXAoZnVuY3Rpb24oY2F0ZWdvcnksIGluZGV4KXtcbiAgICAvLyBEcmF3IGxlZ2VuZCBsaXN0XG4gICAgdmFyIGxpID0gbGVnZW5kcy5hcHBlbmQoJ2xpJylcbiAgICAgIC5hdHRyKCdjbGFzcycsICdjb2wtNCAnICsgKGNhdGVnb3J5LmlzRGlzYWJsZWQgPyAnZXhjbHVkZScgOiAnJykpXG4gICAgICAuc3R5bGUoJ2NvbG9yJywgZnVuY3Rpb24oZCkge3JldHVybiBjb2xvcihjYXRlZ29yeS5uYW1lKTsgfSlcbiAgICAgIC5odG1sKFwiPHNwYW4gY2xhc3M9J2RlZmF1bHQtY29sb3InPlwiK2NhdGVnb3J5Lm5hbWUrXCI8L3NwYW4+XCIpXG4gICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oZCkge1xuICAgICAgICBjYXRlZ29yeS5pc0Rpc2FibGVkID0gIWNhdGVnb3J5LmlzRGlzYWJsZWQ7XG4gICAgICAgIGNhdGVnb3JpZXMgPSBfLnNvcnRCeShjYXRlZ29yaWVzLCBbZnVuY3Rpb24obykgeyByZXR1cm4gby5pc0Rpc2FibGVkOyB9XSk7XG4gICAgICAgIGxlZ2VuZHMuaHRtbCgnJyk7XG4gICAgICAgIHNvcnRDYXRlZ29yeUxlZ2VuZCgpO1xuXG4gICAgICAgIC8vIFJlZHJhdyBncmFwaCBzaW5jZSBhIGNhdGVnb3J5IGlzIGRpc2FibGVkXG4gICAgICAgIGNvbmNlbnRyYXRpb25zID0gY2F0ZWdvcmllcy5tYXAoZnVuY3Rpb24oY2F0ZWdvcnksIGluZGV4KXtcbiAgICAgICAgICBpZiAoIWNhdGVnb3J5LmlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7Y2F0ZWdvcnk6IGNhdGVnb3J5Lm5hbWUsIGRhdGFwb2ludHM6IGRhdGEubWFwKGZ1bmN0aW9uKGQpe1xuICAgICAgICAgICAgICByZXR1cm4ge2RhdGU6IGRbeExhYmVsXSwgY29uY2VudHJhdGlvbjogK2RbY2F0ZWdvcnkubmFtZV19XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC8vIFJlbW92ZSBmYWxzeSB2YWx1ZXMgb2YgbGVnZW5kc1xuICAgICAgICBjb25jZW50cmF0aW9ucyA9IF8uY29tcGFjdChjb25jZW50cmF0aW9ucyk7XG4gICAgICAgIHN2Zy5odG1sKCcnKTtcblxuICAgICAgICBkcmF3R3JhcGgoKTtcblxuICAgICAgfSk7XG4gIH0pXG59XG5cbnZhciBsZWdlbmRzID0gZDMuc2VsZWN0KCcjbGVnZW5kcyB1bCcpO1xuXG4vLyBSZWFkIGluIGRhdGFcbmQzLmNzdignLi9hc3NldHMvZGF0YS9taWxsZWRSaWNlRW5kaW5nU3RvY2tzLmNzdicsIGZ1bmN0aW9uKGVycm9yLCBjc3ZkYXRhKXtcbiAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgZGF0YSA9IGNzdmRhdGE7XG5cbiAgLy8gR2V0IHRoZSBmaXJzdCBrZXkgbmFtZSBmb3IgeSBheGlzXG4gIHhMYWJlbCA9IGQzLmtleXMoZGF0YVswXSlbMF07XG5cbiAgLy8gU2V0IHRoZSBjb2xvciBkb21haW4gZXF1YWwgdG8gdGhlIHRocmVlIGNhdGVnb3JpZXNcbiAgY2F0ZWdvcmllcyA9IGQzLmtleXMoZGF0YVswXSkuc2xpY2UoMSlcbiAgY29sb3IuZG9tYWluKGNhdGVnb3JpZXMpO1xuXG4gIC8vIFJlZm9ybWF0IGRhdGEgdG8gbWFrZSBpdCBtb3JlIGNvcGFzZXRpYyBmb3IgZDNcbiAgLy8gZGF0YSA9IEFuIGFycmF5IG9mIG9iamVjdHNcbiAgLy8gY29uY2VudHJhdGlvbnMgPSBBbiBhcnJheSBvZiB0aHJlZSBvYmplY3RzLCBlYWNoIG9mIHdoaWNoIGNvbnRhaW5zIGFuIGFycmF5IG9mIG9iamVjdHNcbiAgLy8gU2V0IHRoZSBsZWdlbmRzXG4gIGNvbmNlbnRyYXRpb25zID0gY2F0ZWdvcmllcy5tYXAoZnVuY3Rpb24oY2F0ZWdvcnksIGluZGV4KXtcbiAgICBjYXRlZ29yaWVzW2luZGV4XSA9IHsgbmFtZTogY2F0ZWdvcnksIGlzRGlzYWJsZWQ6IGZhbHNlfVxuICAgIGxlZ2VuZHMuaHRtbCgnJyk7XG4gICAgc29ydENhdGVnb3J5TGVnZW5kKCk7XG5cbiAgICByZXR1cm4ge2NhdGVnb3J5OiBjYXRlZ29yeSwgZGF0YXBvaW50czogZGF0YS5tYXAoZnVuY3Rpb24oZCl7XG4gICAgICByZXR1cm4ge2RhdGU6IGRbeExhYmVsXSwgY29uY2VudHJhdGlvbjogK2RbY2F0ZWdvcnldfVxuICAgIH0pfVxuICB9KVxuXG4gIGRyYXdHcmFwaCgpO1xuXG59KTtcblxuZnVuY3Rpb24gZHJhd0dyYXBoICgpIHtcbiAgLy8gU2V0IHRoZSBkb21haW4gb2YgdGhlIGF4ZXNcbiAgeFNjYWxlLmRvbWFpbihkMy5leHRlbnQoZGF0YSwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZFt4TGFiZWxdOyB9KSk7XG4gIHlTY2FsZS5kb21haW4oW1xuICAgIGQzLm1pbihjb25jZW50cmF0aW9ucywgZnVuY3Rpb24oYykgeyByZXR1cm4gZDMubWluKGMuZGF0YXBvaW50cywgZnVuY3Rpb24odikgeyByZXR1cm4gdi5jb25jZW50cmF0aW9uOyB9KTsgfSksXG4gICAgZDMubWF4KGNvbmNlbnRyYXRpb25zLCBmdW5jdGlvbihjKSB7IHJldHVybiBkMy5tYXgoYy5kYXRhcG9pbnRzLCBmdW5jdGlvbih2KSB7IHJldHVybiB2LmNvbmNlbnRyYXRpb247IH0pOyB9KVxuICBdKTtcblxuICAvLyBQbGFjZSB0aGUgYXhlcyBvbiB0aGUgY2hhcnRcbiAgc3ZnLmFwcGVuZCgnZycpXG4gICAgICAuYXR0cignY2xhc3MnLCAneCBheGlzJylcbiAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChoZWlnaHQpICsgJyknKVxuICAgICAgLmNhbGwoeEF4aXMpXG4gICAgICAuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgIC5hdHRyKCd5JywgMTApO1xuICAgICAgLy8gLmF0dHIoJ3gnLCA2KVxuICAgICAgLy8gLnN0eWxlKCd0ZXh0LWFuY2hvcicsICdzdGFydCcpO1xuXG4gIHN2Zy5hcHBlbmQoJ2cnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ3kgYXhpcycpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMClcbiAgICAgIC5jYWxsKHlBeGlzKVxuICAgICAgLm9uKCdlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdsYWJlbCcpXG4gICAgICAgIC5hdHRyKCd5JywgLTEwKVxuICAgICAgICAvLyAuYXR0cignZHknLCAnLjcxZW0nKVxuICAgICAgICAvLyAuYXR0cignZHgnLCAnLTFlbScpXG4gICAgICAgIC5hdHRyKCdmaWxsJywgJyMzMzMzMzMnKVxuICAgICAgICAuc3R5bGUoJ3RleHQtYW5jaG9yJywgJ2VuZCcpXG4gICAgICAgIC50ZXh0KCdQcm9kdWN0aW9uJyk7XG4gICAgICB9KTsgIFxuXG4gIC8vIFJlYWxpZ24geSB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcueS5heGlzIHRleHQnKS5hdHRyKCdkeScsIC00KTtcblxuICAvLyBEcmF3IHRvb2x0aXAgdmVydGljYWwgbGluZSBpbiBob3ZlclxuICB0b29sdGlwTGluZSA9IHN2Zy5hcHBlbmQoJ2xpbmUnKTtcblxuICAvLyBEcmF3IHRvb2xpcCBib3hcbiAgdGlwQm94ID0gc3ZnLmFwcGVuZCgncmVjdCcpXG4gICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpXG4gICAgICAuYXR0cignb3BhY2l0eScsIDApXG4gICAgICAub24oJ21vdXNlbW92ZScsIGRyYXdUb29sdGlwKVxuICAgICAgLm9uKCdtb3VzZW91dCcsIHJlbW92ZVRvb2x0aXApO1xuXG5cbiAgLy8gRHJhdyB0aGUgZ3JhcGhcbiAgY2F0ZWdvcnlMaW5lID0gc3ZnLnNlbGVjdEFsbCgnLmNhdGVnb3J5JylcbiAgICAgIC5kYXRhKGNvbmNlbnRyYXRpb25zKVxuICAgICAgLmVudGVyKCkuYXBwZW5kKCdnJylcbiAgICAgIC5hdHRyKCdjbGFzcycsICdjYXRlZ29yeScpO1xuICBcbiAgLy8gRHJhdyBlYWNoIHBhdGhcbiAgdmFyIGNhdFBhdGggPSBjYXRlZ29yeUxpbmUuYXBwZW5kKCdwYXRoJylcbiAgICAgIC5hdHRyKCdjbGFzcycsICdsaW5lJylcbiAgICAgIC5hdHRyKCdkJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gbGluZShkLmRhdGFwb2ludHMpOyB9KVxuICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICcycHgnKVxuICAgICAgLmF0dHIoJ2ZpbGwnLCAnbm9uZScpXG4gICAgICAuYXR0cignc3Ryb2tlJywgZnVuY3Rpb24oZCkge3JldHVybiBjb2xvcihkLmNhdGVnb3J5KTsgfSlcbiAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZCkgeyBcbiAgICAgICAgLy8gb24gbW91c2UgaW4gc2hvdyBsaW5lLCBjaXJjbGVzIGFuZCB0ZXh0XG4gICAgICAgIGQzLnNlbGVjdCh0aGlzKS5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzNweCcpO1xuICAgICAgfSlcbiAgICAgIC5vbignbW91c2Vtb3ZlJywgZHJhd1Rvb2x0aXApXG4gICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oKSB7IFxuICAgICAgICBkMy5zZWxlY3QodGhpcykuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcycHgnKTtcbiAgICAgIH0pO1xuXG4gIC8vIEFuaW1hdGUgcGF0aFxuICBjYXRQYXRoLmVhY2goZnVuY3Rpb24oZCkgeyBkLnRvdGFsTGVuZ3RoID0gdGhpcy5nZXRUb3RhbExlbmd0aCgpOyB9KVxuICAgICAgLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudG90YWxMZW5ndGggKyBcIiBcIiArIGQudG90YWxMZW5ndGg7IH0pXG4gICAgICAuYXR0cihcInN0cm9rZS1kYXNob2Zmc2V0XCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudG90YWxMZW5ndGg7IH0pXG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24oNTAwKVxuICAgICAgLmF0dHIoXCJzdHJva2UtZGFzaG9mZnNldFwiLCAwKTtcblxuICAvLyBEcmF3IGpvaW50IGxpbmUgY2lybGNlXG4gIGNhdGVnb3J5TGluZS5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ2NpcmNsZScpXG4gICAgICAuZGF0YShmdW5jdGlvbihkKXsgcmV0dXJuIGQuZGF0YXBvaW50cyB9KVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoJ2NpcmNsZScpXG4gICAgICAvLyBBZGQgdW5pcXVlIGNsYXNzIHRvIGhpZGUvc2hvdyBvbiBob3ZlclxuICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZGQpe3JldHVybiAnY2lyY2xlLScgKyBkZC5kYXRlfSlcbiAgICAgIC5hdHRyKCdyJywgMilcbiAgICAgIC5hdHRyKCdjeCcsIGZ1bmN0aW9uKGRkKXtyZXR1cm4geFNjYWxlKGRkLmRhdGUpfSlcbiAgICAgIC5hdHRyKCdjeScsIGZ1bmN0aW9uKGRkKXtyZXR1cm4geVNjYWxlKGRkLmNvbmNlbnRyYXRpb24pfSlcbiAgICAgIC5hdHRyKCdmaWxsJywgZnVuY3Rpb24oZCkge3JldHVybiBjb2xvcihkLmNhdGVnb3J5KTsgfSlcbiAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24oZCkge3JldHVybiBjb2xvcihkLmNhdGVnb3J5KTsgfSlcbiAgICAgIC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG5cbn1cblxuXG5cbi8vIERlZmluZSByZXNwb25zaXZlIGJlaGF2aW9yXG5mdW5jdGlvbiByZXNpemUgKCkge1xuICAvLyBSZXNpemUgY2hhcnRcbiAgdmFyIGNoYXJ0Q29udGFpbmVyV2lkdGggPSBwYXJzZUludChkMy5zZWxlY3QoJy5jaGFydC1pbmZvJykuc3R5bGUoJ3dpZHRoJykpICogLjgzXG4gIGQzLnNlbGVjdEFsbCgnI2NoYXJ0JykudHJhbnNpdGlvbigpXG4gICAgICAuc3R5bGUoJ3dpZHRoJywgY2hhcnRDb250YWluZXJXaWR0aClcbiAgICAgIC5kdXJhdGlvbigxMDApXG4gICAgICAuZGVsYXkoMjAwKVxuICAgICAgLm9uKCdlbmQnLCBhZGp1c3QgKTtcbn1cblxuLy8gQWRkanVzdCBHcmFwaFxuZnVuY3Rpb24gYWRqdXN0KCkge1xuICAvLyBHZXQgdGhlIG5ldyBzaXplXG4gIHdpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KCcjY2hhcnQnKS5zdHlsZSgnd2lkdGgnKSkgLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDtcbiAgaGVpZ2h0ID0gcGFyc2VJbnQoZDMuc2VsZWN0KCcjY2hhcnQnKS5zdHlsZSgnaGVpZ2h0JykpIC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG5cbiAgLy8gVXBkYXRlIHRoZSByYW5nZSBvZiB0aGUgc2NhbGUgd2l0aCBuZXcgd2lkdGgvaGVpZ2h0IGFuZCB0aGUgdGlja3NpemUgZ2FwXG4gIHhTY2FsZS5yYW5nZShbMCwgd2lkdGhdKTtcbiAgeVNjYWxlLnJhbmdlKFtoZWlnaHQsIDBdKTtcblxuICB5QXhpcy50aWNrU2l6ZSgtd2lkdGgsIDAsIDApO1xuXG4gIC8vIFVwZGF0ZSB0aGUgYXhpcyBhbmQgdGV4dCB3aXRoIHRoZSBuZXcgc2NhbGVcbiAgc3ZnLnNlbGVjdCgnLnguYXhpcycpXG4gICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwnICsgaGVpZ2h0ICsgJyknKVxuICAgIC5jYWxsKHhBeGlzKTtcblxuICBzdmcuc2VsZWN0KCcueS5heGlzJylcbiAgICAuY2FsbCh5QXhpcyk7XG5cbiAgLy8gRm9yY2UgRDMgdG8gcmVjYWxjdWxhdGUgYW5kIHVwZGF0ZSB0aGUgbGluZVxuICBzdmcuc2VsZWN0QWxsKCcubGluZScpXG4gICAgLmF0dHIoJ2QnLCBmdW5jdGlvbihkKSB7IHJldHVybiBsaW5lKGQuZGF0YXBvaW50cyk7IH0pO1xuXG4gIC8vIFVwZGF0ZSBjaXJjbGUgcG9pbnRcbiAgc3ZnLnNlbGVjdEFsbCgnY2lyY2xlJylcbiAgICAgIC5hdHRyKCdjeCcsIGZ1bmN0aW9uKGRkKXtyZXR1cm4geFNjYWxlKGRkLmRhdGUpfSlcbiAgICAgIC5hdHRyKCdjeScsIGZ1bmN0aW9uKGRkKXtyZXR1cm4geVNjYWxlKGRkLmNvbmNlbnRyYXRpb24pfSk7XG5cbiAgLy8gVXBkYXRlIFJlY3RhbmdsZSBmb3IgbW91c2UgZXZlbnRcbiAgc3ZnLnNlbGVjdEFsbCgncmVjdCcpXG4gICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuXG4gIC8vIFVwZGF0ZSB0aGUgdGljayBtYXJrc1xuICB4QXhpcy50aWNrcyhNYXRoLmZsb29yKE1hdGgubWF4KHdpZHRoLzY1LCA0KSkpO1xuICB5QXhpcy50aWNrcyhNYXRoLmZsb29yKE1hdGgubWF4KGhlaWdodC8zMCwgNCkpKTtcblxufTtcblxuXG4vLyBDYWxsIHRoZSByZXNpemUgZnVuY3Rpb24gd2hlbmV2ZXIgYSByZXNpemUgZXZlbnQgb2NjdXJzXG5kMy5zZWxlY3Qod2luZG93KS5vbigncmVzaXplJywgIHJlc2l6ZSApO1xuXG4vLyBDYWxsIHRoZSByZXNpemUgZnVuY3Rpb25cbmFkanVzdCgpOyJdLCJmaWxlIjoiYXNzZXRzL2pzL21haW4uanMifQ==
